---
phase: 02-font-loading-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - public/fonts/darker-grotesque-variable.woff2
  - public/fonts/manrope-variable.woff2
  - src/layouts/Base.astro
  - src/styles/tailwind.css
autonomous: true
must_haves:
  truths:
    - "Hero text renders immediately on page load with no visible layout shift (CLS < 0.1)"
    - "Fonts are self-hosted from /fonts/ — no Google Fonts CDN requests"
    - "Darker Grotesque variable font supports weight range 300-900"
    - "Manrope variable font supports weight range 200-800"
  artifacts:
    - path: "public/fonts/darker-grotesque-variable.woff2"
      provides: "Self-hosted Darker Grotesque variable font"
    - path: "public/fonts/manrope-variable.woff2"
      provides: "Self-hosted Manrope variable font"
    - path: "src/layouts/Base.astro"
      provides: "Preload link for hero font, no Google Fonts links"
      contains: "rel=\"preload\""
    - path: "src/styles/tailwind.css"
      provides: "@font-face declarations with font-display: swap"
      contains: "font-display: swap"
  key_links:
    - from: "src/layouts/Base.astro"
      to: "public/fonts/darker-grotesque-variable.woff2"
      via: "preload link with crossorigin"
      pattern: "preload.*darker-grotesque.*crossorigin"
    - from: "src/styles/tailwind.css"
      to: "public/fonts/darker-grotesque-variable.woff2"
      via: "@font-face src url"
      pattern: "url\\(.*/fonts/darker-grotesque"
    - from: "src/styles/tailwind.css"
      to: "public/fonts/manrope-variable.woff2"
      via: "@font-face src url"
      pattern: "url\\(.*/fonts/manrope"
---

<objective>
Self-host both web fonts as WOFF2 variable fonts, replacing Google Fonts CDN. Preload the hero display font (Darker Grotesque) to prevent layout shift.

Purpose: Eliminate external font CDN dependency, reduce payload (~376KB to ~89KB), prevent CLS on hero typography at viewport scale.
Output: Self-hosted fonts in public/fonts/, @font-face declarations, preload link in head.
</objective>

<execution_context>
@C:/Users/adria/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/adria/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-font-loading-optimization/02-RESEARCH.md
@src/layouts/Base.astro
@src/styles/tailwind.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install fontsource packages and copy WOFF2 variable fonts to public/fonts</name>
  <files>public/fonts/darker-grotesque-variable.woff2, public/fonts/manrope-variable.woff2</files>
  <action>
    1. Install @fontsource-variable packages:
       ```
       npm install @fontsource-variable/darker-grotesque @fontsource-variable/manrope
       ```

    2. Create `public/fonts/` directory.

    3. Copy the WOFF2 variable font files from the installed packages to public/fonts/:
       - From `node_modules/@fontsource-variable/darker-grotesque/files/` find the woff2 variable font file (look for a file like `darker-grotesque-latin-wght-normal.woff2` or similar — the exact name varies, check the directory listing)
       - From `node_modules/@fontsource-variable/manrope/files/` find the equivalent Manrope woff2 file
       - Copy them to `public/fonts/darker-grotesque-variable.woff2` and `public/fonts/manrope-variable.woff2`

    4. Verify file sizes — Darker Grotesque should be ~40-60KB, Manrope ~30-50KB. If either exceeds 100KB, note it but proceed.

    Note: We install via npm for easy reproducibility but copy the actual font files to public/ for direct serving. The npm packages are a convenient download mechanism — we do NOT import their CSS.
  </action>
  <verify>
    - `ls -la public/fonts/` shows both .woff2 files exist
    - File sizes are reasonable (under 100KB each)
  </verify>
  <done>Both WOFF2 variable font files exist in public/fonts/ and are valid font files.</done>
</task>

<task type="auto">
  <name>Task 2: Replace Google Fonts with self-hosted @font-face and preload</name>
  <files>src/layouts/Base.astro, src/styles/tailwind.css</files>
  <action>
    **In src/layouts/Base.astro:**

    1. Remove these three lines from the head:
       ```html
       <link rel="preconnect" href="https://fonts.googleapis.com" />
       <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
       <link href="https://fonts.googleapis.com/css2?family=Darker+Grotesque:wght@300..900&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
       ```

    2. Add preload for the hero display font ONLY (before the title tag):
       ```html
       <link rel="preload" href="/fonts/darker-grotesque-variable.woff2" as="font" type="font/woff2" crossorigin />
       ```
       CRITICAL: The `crossorigin` attribute is required even for same-origin fonts — without it the browser downloads the font twice. Do NOT preload Manrope (body font, not critical for LCP).

    **In src/styles/tailwind.css:**

    3. Add @font-face declarations BEFORE the `@import "tailwindcss";` line (so they are available when Tailwind processes theme values):
       ```css
       /* Self-hosted variable fonts */
       @font-face {
         font-family: 'Darker Grotesque';
         src: url('/fonts/darker-grotesque-variable.woff2') format('woff2-variations');
         font-weight: 300 900;
         font-display: swap;
         font-style: normal;
       }

       @font-face {
         font-family: 'Manrope';
         src: url('/fonts/manrope-variable.woff2') format('woff2-variations');
         font-weight: 200 800;
         font-display: swap;
         font-style: normal;
       }
       ```

    4. The existing --font-heading and --font-sans theme values already reference 'Darker Grotesque' and 'Manrope' — no changes needed to the @theme block.

    Skip font metric overrides (ascent-override, descent-override, size-adjust) per user's minimal approach directive. The preload + font-display:swap combination already handles the critical path. Metric overrides are a nice-to-have refinement.
  </action>
  <verify>
    - `npm run build` completes without errors
    - Inspect dist/index.html: no references to fonts.googleapis.com, has preload link for darker-grotesque
    - Inspect dist output: fonts directory contains both woff2 files
  </verify>
  <done>
    - Base.astro has no Google Fonts links and has preload for Darker Grotesque with crossorigin
    - tailwind.css has @font-face declarations for both fonts with font-display: swap and format('woff2-variations')
    - Build succeeds cleanly
  </done>
</task>

</tasks>

<verification>
1. No network requests to fonts.googleapis.com or fonts.gstatic.com (check build output HTML)
2. Both font files served from /fonts/ path
3. Darker Grotesque preloaded in document head with crossorigin attribute
4. Both @font-face declarations use font-display: swap and format('woff2-variations')
5. Site builds without errors
</verification>

<success_criteria>
- Google Fonts CDN completely removed from the site
- Both fonts self-hosted as WOFF2 variable fonts
- Hero font (Darker Grotesque) preloaded to prevent layout shift
- Build passes, fonts render correctly
</success_criteria>

<output>
After completion, create `.planning/phases/02-font-loading-optimization/02-01-SUMMARY.md`
</output>
