---
phase: 03-visual-effects-section-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/index.astro
  - src/styles/tailwind.css
autonomous: true

must_haves:
  truths:
    - "User sees gradient text on hero headline with no visual change from Phase 1 result"
    - "User on unsupported browser sees solid fallback color instead of invisible text"
    - "User scrolls down and sees below-fold sections fade in as they enter the viewport"
    - "User with prefers-reduced-motion enabled sees no animations — sections appear immediately"
    - "User on Firefox (no scroll-timeline support) still sees fade-in animations via Intersection Observer fallback"
  artifacts:
    - path: "src/pages/index.astro"
      provides: "Scroll animation classes on sections, Intersection Observer fallback script, gradient @supports fallback, containment on hero"
    - path: "src/styles/tailwind.css"
      provides: "Scroll-driven animation keyframes, .animate-on-scroll styles, prefers-reduced-motion media queries"
  key_links:
    - from: "src/styles/tailwind.css"
      to: "src/pages/index.astro"
      via: ".animate-on-scroll class applied to sections"
      pattern: "animate-on-scroll"
    - from: "src/pages/index.astro <script>"
      to: ".animate-on-scroll elements"
      via: "Intersection Observer fallback when CSS scroll-timeline unsupported"
      pattern: "CSS\\.supports.*animation-timeline"
---

<objective>
Add scroll-driven fade-in animations to below-fold homepage sections and optimize the existing hero gradient text for robustness.

Purpose: Fulfill EFCT-01 (gradient preservation with optimization) and EFCT-02 (scroll-driven animations) — the visual effects requirements that make the page feel alive as users scroll beyond the bold hero.

Output: Homepage sections animate into view on scroll; hero gradient has browser fallback; all animations respect prefers-reduced-motion.
</objective>

<execution_context>
@C:/Users/adria/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/adria/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-visual-effects-section-polish/03-RESEARCH.md
@.planning/phases/01-typography-foundation/01-01-SUMMARY.md
@src/pages/index.astro
@src/styles/tailwind.css
@src/styles/custom.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add scroll-driven animations and gradient robustness to CSS</name>
  <files>src/styles/tailwind.css, src/pages/index.astro</files>
  <action>
In `src/styles/tailwind.css`, add the following after the existing keyframes section:

1. **Scroll-driven animation styles** (outside any @layer, alongside existing keyframes):

```css
/* ── Scroll-driven section animations ── */
.animate-on-scroll {
  opacity: 0;
  transform: translateY(2rem);
  transition: opacity 0.6s ease-out, transform 0.6s ease-out;
}

.animate-on-scroll.is-visible {
  opacity: 1;
  transform: translateY(0);
}

/* CSS Scroll-Driven Animations (Chrome 115+, Safari 26+) */
@supports (animation-timeline: view()) {
  .animate-on-scroll {
    transition: none;
    animation: scroll-fade-in linear both;
    animation-timeline: view();
    animation-range: entry 0% cover 30%;
  }

  .animate-on-scroll.is-visible {
    /* Reset JS fallback class — CSS scroll-timeline handles it */
    opacity: 0;
    transform: translateY(2rem);
  }

  @keyframes scroll-fade-in {
    from {
      opacity: 0;
      transform: translateY(2rem);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
}

/* Accessibility: disable all scroll animations for motion-sensitive users */
@media (prefers-reduced-motion: reduce) {
  .animate-on-scroll {
    opacity: 1;
    transform: none;
    transition: none;
    animation: none;
  }
}
```

2. **CSS containment on hero section** — add to the shared component styles area:

```css
/* GPU isolation for hero effects */
.hero {
  contain: layout paint;
}
```

3. **Gradient text @supports fallback** — In `src/pages/index.astro`, inside the existing `<style>` block, add after the `.hero-title` gradient styles:

```css
@supports not (background-clip: text) {
  .hero-title {
    background: none;
    -webkit-text-fill-color: unset;
    color: var(--color-text);
  }
}
```

This ensures browsers that don't support `background-clip: text` show a solid color instead of invisible text.

**Important:** Do NOT change any existing gradient styles, glow styles, or hero-title gradient direction/colors. EFCT-01 requires preservation of existing effects — only add robustness, not visual changes.
  </action>
  <verify>
Run `npm run build` — build completes without errors.

Grep for `animate-on-scroll` in tailwind.css — class exists with opacity/transform styles.
Grep for `animation-timeline: view()` in tailwind.css — CSS scroll-timeline present inside @supports block.
Grep for `prefers-reduced-motion` in tailwind.css — media query wrapping animation removal.
Grep for `@supports not (background-clip: text)` in index.astro — fallback exists.
Grep for `contain: layout paint` in tailwind.css — hero containment present.
  </verify>
  <done>
Scroll animation CSS with both native scroll-timeline and JS-class-based approach defined. Reduced-motion users see no animation. Gradient has browser fallback. Hero has CSS containment.
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply animation classes to sections and add Intersection Observer fallback</name>
  <files>src/pages/index.astro</files>
  <action>
1. **Add `animate-on-scroll` class to below-fold sections** in `src/pages/index.astro`. Add the class to each section element EXCEPT the hero (hero is above fold, should not animate in). Target these sections:

- `section.section-problem` — add `animate-on-scroll` to the class list
- `section.section-diff` — add `animate-on-scroll` to the class list
- `section.section-process` — add `animate-on-scroll` to the class list
- `section.section-basics` — add `animate-on-scroll` to the class list
- `section.section-work` — add `animate-on-scroll` to the class list
- `section.section-cta` — add `animate-on-scroll` to the class list

2. **Add Intersection Observer fallback script** at the bottom of the existing `<script>` block in index.astro (after the process panel nav code):

```javascript
// Scroll animation: Intersection Observer fallback for browsers without CSS scroll-timeline
const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
const supportsScrollTimeline = CSS.supports('animation-timeline', 'view()');

if (!prefersReducedMotion && !supportsScrollTimeline) {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('is-visible');
        observer.unobserve(entry.target);
      }
    });
  }, {
    threshold: 0.1,
    rootMargin: '0px 0px -10% 0px'
  });

  document.querySelectorAll('.animate-on-scroll').forEach(el => observer.observe(el));
}
```

**Key details:**
- Check `prefers-reduced-motion` first — if user wants reduced motion, skip observer entirely (CSS handles this via the media query making elements visible)
- Check `CSS.supports('animation-timeline', 'view()')` — if browser supports native scroll-timeline, skip JS fallback (CSS handles it)
- `observer.unobserve` after first intersection — one-time animation, not repeated on scroll up/down
- `threshold: 0.1` — trigger when 10% visible
- `rootMargin: '0px 0px -10% 0px'` — slight delay so animation doesn't start at very bottom edge
  </action>
  <verify>
Run `npm run build` — build completes without errors.

Grep for `animate-on-scroll` in index.astro — class present on section-problem, section-diff, section-process, section-basics, section-work, section-cta (6 sections).
Grep for `IntersectionObserver` in index.astro — fallback script present.
Grep for `supportsScrollTimeline` in index.astro — feature detection present.
Grep for `prefers-reduced-motion` in index.astro — motion preference check present.

Verify the hero section does NOT have `animate-on-scroll` class.
  </verify>
  <done>
All below-fold sections have animate-on-scroll class. Intersection Observer fallback runs only when needed (no CSS scroll-timeline, no reduced motion). Sections fade in as user scrolls. Hero is excluded from scroll animation.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Open dev server (`npm run dev`) and scroll the homepage — below-fold sections should fade in
3. In Chrome DevTools, verify `.animate-on-scroll` elements have `animation-timeline: view()` applied
4. Test with `prefers-reduced-motion: reduce` in DevTools — all sections should appear immediately with no animation
5. Hero gradient text looks identical to Phase 1 result — no visual change
6. Hero section has `contain: layout paint` in computed styles
</verification>

<success_criteria>
- All 6 below-fold sections animate on scroll (fade-in + translateY)
- Hero gradient text preserved exactly as-is (EFCT-01)
- Animations respect prefers-reduced-motion (WCAG 2.3.3)
- Intersection Observer fallback works in Firefox
- No performance regression (GPU-accelerated transform + opacity only)
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-visual-effects-section-polish/03-01-SUMMARY.md`
</output>
