---
import Base from "../layouts/Base.astro";
---

<Base title="Contact | Plain Sight" description="Tell us about your project. We'll respond within a few hours.">
  <main class="container pt-32 pb-16 max-md:pt-24">
    <section class="bg-surface border border-border rounded-2xl py-14 px-12 max-md:py-10 max-md:px-6 mb-10">
      <h1 class="text-page-hero font-extrabold leading-snug mb-4">Let's talk about your project</h1>
      <p class="text-text-muted text-[1.125rem] leading-loose max-w-[540px]">Tell us a little about what you're working on and we'll take it from there.</p>
    </section>

    <section class="grid grid-cols-[1fr_360px] max-md:grid-cols-1 gap-8 items-start">
      <div class="bg-surface border border-border rounded-2xl p-10 max-md:py-8 max-md:px-6">
        <form action="https://formspree.io/f/xvzbokbq" method="POST" class="contact-form flex flex-col gap-6">
          <div class="flex flex-col gap-2">
            <label for="brings-you" class="font-semibold text-[0.9rem] tracking-wide">What brings you here?</label>
            <select id="brings-you" name="brings-you" required>
              <option value="" disabled selected>Select one...</option>
              <option value="exploring">I'm exploring my options</option>
              <option value="new-site">I need a new website</option>
              <option value="existing-site">I need help with an existing site</option>
              <option value="ongoing-partner">I'm looking for an ongoing partner</option>
            </select>
          </div>

          <div class="grid grid-cols-2 max-md:grid-cols-1 gap-4">
            <div class="flex flex-col gap-2">
              <label for="name" class="font-semibold text-[0.9rem] tracking-wide">Name</label>
              <input type="text" id="name" name="name" required />
            </div>
            <div class="flex flex-col gap-2">
              <label for="email" class="font-semibold text-[0.9rem] tracking-wide">Email</label>
              <input type="email" id="email" name="email" required />
            </div>
          </div>

          <div class="flex flex-col gap-2">
            <label for="phone" class="font-semibold text-[0.9rem] tracking-wide">Phone <span class="text-text-dim font-normal">(optional)</span></label>
            <input type="tel" id="phone" name="phone" />
          </div>

          <div class="flex flex-col gap-2">
            <label for="message" class="font-semibold text-[0.9rem] tracking-wide">Message</label>
            <textarea id="message" name="message" rows="5" required placeholder="What are you working on? What's the timeline? Any details help."></textarea>
          </div>

          <button type="submit" class="btn btn-cta self-start mt-2">Send it</button>
        </form>
      </div>

      <aside class="flex flex-col gap-6 sticky top-24 max-md:static">
        <div class="bg-surface border border-border rounded-2xl p-8">
          <h2 class="text-[1.15rem] font-bold mb-5">What happens next</h2>
          <ol class="list-none p-0 m-0 flex flex-col gap-4">
            <li class="flex gap-3 items-start text-[0.95rem] text-text-muted leading-normal">
              <span class="shrink-0 w-7 h-7 flex items-center justify-center rounded-full bg-accent-subtle text-accent-hover text-[0.8rem] font-bold font-mono">1</span>
              <span>We'll respond within one business day (usually sooner)</span>
            </li>
            <li class="flex gap-3 items-start text-[0.95rem] text-text-muted leading-normal">
              <span class="shrink-0 w-7 h-7 flex items-center justify-center rounded-full bg-accent-subtle text-accent-hover text-[0.8rem] font-bold font-mono">2</span>
              <span>We'll set up a quick discovery call to dig into what you're working on</span>
            </li>
            <li class="flex gap-3 items-start text-[0.95rem] text-text-muted leading-normal">
              <span class="shrink-0 w-7 h-7 flex items-center justify-center rounded-full bg-accent-subtle text-accent-hover text-[0.8rem] font-bold font-mono">3</span>
              <span>You'll walk away with a clear picture of what your project actually needs</span>
            </li>
          </ol>
        </div>

        <div class="bg-surface-raised border border-border rounded-2xl py-6 px-8">
          <p class="text-[0.85rem] text-text-dim mb-3 uppercase tracking-[0.06em] font-semibold">Or reach us directly</p>
          <div class="flex flex-col gap-2">
            <a href="mailto:hello@plainsight.works" class="group text-text-muted no-underline text-[0.95rem] flex items-center gap-2 transition-colors duration-fast hover:text-accent-hover hover:no-underline">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="shrink-0 opacity-60 group-hover:opacity-100 transition-opacity"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M22 4L12 13 2 4"/></svg>
              hello@plainsight.works
            </a>
            <a href="https://www.linkedin.com/company/plainsight-works/" target="_blank" rel="noopener noreferrer" class="group text-text-muted no-underline text-[0.95rem] flex items-center gap-2 transition-colors duration-fast hover:text-accent-hover hover:no-underline">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="shrink-0 opacity-60 group-hover:opacity-100 transition-opacity"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-4 0v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
              LinkedIn
            </a>
          </div>
        </div>
      </aside>
    </section>

    <dialog class="form-success">
      <h2 class="text-2xl font-semibold mb-3">Message sent</h2>
      <p class="text-text-muted leading-loose mb-6">We'll be in touch soon. Keep an eye on your inbox.</p>
      <button class="btn form-success-close w-full">Got it</button>
    </dialog>
  </main>
</Base>

<style>
  .contact-form input,
  .contact-form select,
  .contact-form textarea {
    padding: 0.8rem 1rem;
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: 0.5rem;
    color: var(--color-text);
    font-family: inherit;
    font-size: 1rem;
    transition: border-color var(--duration-fast) ease,
                box-shadow var(--duration-fast) ease;
  }

  .contact-form input:focus,
  .contact-form select:focus,
  .contact-form textarea:focus {
    outline: none;
    border-color: var(--color-accent);
    box-shadow: 0 0 0 3px var(--color-accent-subtle);
  }

  .contact-form textarea {
    resize: vertical;
    min-height: 120px;
  }

  .contact-form textarea::placeholder {
    color: var(--color-text-dim);
  }

  .form-success {
    position: fixed;
    top: 50%;
    left: 50%;
    translate: -50% -50%;
    margin: 0;
    background: var(--color-surface);
    color: var(--color-text);
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    padding: 2.5rem;
    max-width: 400px;
    width: 90%;
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .form-success[open] {
    opacity: 1;
  }

  .form-success::backdrop {
    background: rgba(0, 0, 0, 0);
    transition: background 0.2s ease;
  }

  .form-success[open]::backdrop {
    background: rgba(0, 0, 0, 0.6);
  }
</style>

<script>
  const form = document.querySelector('.contact-form') as HTMLFormElement;
  const dialog = document.querySelector('.form-success') as HTMLDialogElement;
  const closeBtn = document.querySelector('.form-success-close') as HTMLButtonElement;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const btn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
    btn.disabled = true;
    btn.textContent = 'Sending...';

    try {
      const res = await fetch(form.action, {
        method: 'POST',
        body: new FormData(form),
        headers: { Accept: 'application/json' },
      });

      if (res.ok) {
        form.reset();
        btn.disabled = false;
        btn.textContent = 'Send it';
        dialog.showModal();
      } else {
        btn.disabled = false;
        btn.textContent = 'Send it';
        alert('Something went wrong. Please try again.');
      }
    } catch {
      btn.disabled = false;
      btn.textContent = 'Send it';
      alert('Something went wrong. Please try again.');
    }
  });

  closeBtn.addEventListener('click', () => dialog.close());
</script>
