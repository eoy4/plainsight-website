---
import { getCollection, render } from "astro:content";
import { Image } from "astro:assets";
import Base from "../layouts/Base.astro";
import CaseStudyCard from "../components/CaseStudyCard.astro";
import CTA from "../components/CTA.astro";
import demiHero from "../assets/case-studies/demi-hero.png";
import upmealsHero from "../assets/case-studies/upmeals-hero.png";
import iconCompass from "../assets/icons/icon-compass.svg";
import iconDisk from "../assets/icons/icon-disk.svg";
import iconRocket from "../assets/icons/icon-rocket.svg";
import iconBulb from "../assets/icons/icon-bulb.svg";

const caseStudyImages: Record<number, ImageMetadata> = {
  1: demiHero,
  2: upmealsHero,
};

const sections = (await getCollection("homepage")).sort(
  (a, b) => a.data.order - b.data.order
);

const rendered = await Promise.all(
  sections.map(async (s) => ({
    ...s,
    rendered: await render(s),
  }))
);

const workEntries = (await getCollection("work")).sort(
  (a, b) => a.data.order - b.data.order
);

const descriptions: Record<number, string> = {
  1: "Complex AI kitchen software that needed to feel simple. We led with operator pain points, not tech jargon, and built a marketing site that makes Demi feel like relief, not another learning curve.",
  2: "Three very different buyers, one brand. We found the common thread, reliability at scale, and built a site where each audience gets spoken to directly without the brand feeling fragmented.",
};

const caseStudies = workEntries.map((entry) => ({
  title: entry.data.title,
  description: descriptions[entry.data.order] ?? entry.data.challenge,
  link: `/work/${entry.id.replace(/^\d+-/, '').replace(/\.md$/, '')}`,
  image: caseStudyImages[entry.data.order],
}));
---

<Base title="Plain Sight | Web Development Agency">
  <main>
    {rendered.map((section) => {
      const { Content } = section.rendered;
      const d = section.data;

      if (d.section === "hero") return (
        <section class="hero dark-section relative min-h-[90vh] flex items-center overflow-hidden" style="background: var(--color-bg-dark-hero); color: var(--color-text-light); --hero-title-gradient-start: var(--color-text-light); --hero-title-gradient-end: var(--color-text-light-muted);">
          <div class="hero-aurora" aria-hidden="true"><div class="hero-aurora-inner"></div></div>
          <div class="container">
            <div class="hero-content relative z-1">
              <h1 class="hero-title font-heading text-hero font-black leading-[0.85] tracking-tighter mb-[var(--spacing-hero-gap)] pb-[0.15em]" style="overflow-wrap: break-word; word-break: normal; hyphens: none; background: linear-gradient(to bottom right, var(--hero-title-gradient-start) 30%, var(--hero-title-gradient-end) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">{d.heading}</h1>
              <p class="hero-tagline text-hero-tagline mb-[var(--spacing-hero-cta-gap)] leading-relaxed font-normal max-w-[900px]" style="color: rgba(255, 255, 255, 0.70);">{d.subheading}</p>
              {d.cta_text && (
                <div class="hero-actions">
                  <a href={d.cta_link} class="btn-primary text-hero-cta">{d.cta_text}</a>
                </div>
              )}
            </div>
          </div>
        </section>
      );

      if (d.section === "problem") return (
        <section class="section-problem animate-on-scroll relative py-section">
          <div class="container relative z-1">
            <h2 class="font-heading text-problem-title font-extrabold tracking-tight text-text mb-12">{d.heading}</h2>
            <div class="section-problem-prose max-w-[1100px] text-problem-prose text-text-muted leading-extra-loose mb-12">
              <p class="mb-6">Most small businesses know they need a website, but the process feels <span class="highlight">overwhelming.</span> Too many options, too many cookie-cutter solutions that slap a template on every business like they're all the same.</p>
              <p class="mb-6">What's missing is <span class="highlight">strategy:</span> understanding what goals your site needs to achieve. More customers? More bookings? Better leads?</p>
            </div>
            <p class="section-problem-kicker max-w-[1100px] text-problem-kicker font-semibold leading-extra-loose text-pop">If your website isn't driving those results, it's just expensive decoration.</p>
          </div>
        </section>
      );

      if (d.section === "differentiators") return (
        <section class="section-diff animate-on-scroll relative py-section bg-gradient-to-b from-surface-alt to-surface-gradient-end">
          <div class="container">
            <div class="mb-12">
              <p class="text-15 font-semibold tracking-widest uppercase text-accent-hover">Why Plain Sight</p>
              <h2 class="font-heading text-section-title font-extrabold tracking-tight">{d.heading}</h2>
            </div>
            <div class="grid grid-cols-2 max-md:grid-cols-1 gap-5">
              {d.items?.map((item, i) => {
                const icons = [iconCompass, iconDisk, iconRocket, iconBulb];
                return (
                <div class="bg-bg rounded-2xl p-10 max-md:p-8 relative overflow-hidden shadow-sm" style={`--card-index: ${i}`}>
                  <div class="mb-5 w-14 h-14 flex items-center justify-center" aria-hidden="true">
                    <img src={icons[i].src} alt="" class={i === 1 ? "w-12 h-12" : "w-14 h-14"} style="filter: invert(47%) sepia(85%) saturate(460%) hue-rotate(139deg) brightness(93%) contrast(91%);" />
                  </div>
                  <div class="font-mono text-17 text-text-dim mb-4 tracking-wider" aria-hidden="true">{String(i + 1).padStart(2, '0')} {['STRATEGY', 'EXPERIENCE', 'EXECUTION', 'TRANSPARENCY'][i]}</div>
                  <h3 class="text-36 font-extrabold mb-6 tracking-snug leading-tight">{item.title}</h3>
                  <p class="text-text-muted leading-loose text-[1.1875rem]">{item.description}</p>
                </div>
              );
              })}
            </div>
          </div>
        </section>
      );

      if (d.section === "process") return (
        <section class="section-process animate-on-scroll relative py-30">
          <div class="process-blob-blur" aria-hidden="true">
            <div class="process-blob"></div>
          </div>
          <div class="container">
            <div class="mb-12">
              <p class="text-15 font-semibold tracking-widest uppercase text-accent-hover">Our process</p>
              <h2 class="font-heading text-section-title font-extrabold tracking-tight">{d.heading}</h2>
            </div>
            <div class="process-panel" data-active="0">
              <div class="process-nav">
                {d.items?.map((item, i) => (
                  <button
                    class="process-nav-item"
                    data-index={i}
                    type="button"
                    aria-controls={`process-detail-${i}`}
                  >
                    <span class="process-nav-number">{String(i + 1).padStart(2, '0')}</span>
                    <span class="process-nav-line" aria-hidden="true"></span>
                    <span class="process-nav-title">{item.title}</span>
                  </button>
                ))}
              </div>
              <div class="process-details">
                {d.items?.map((item, i) => (
                  <div
                    class="process-detail"
                    id={`process-detail-${i}`}
                    data-index={i}
                  >
                    <span class="process-detail-number">{String(i + 1).padStart(2, '0')}</span>
                    <h3 class="process-detail-title">{item.title}</h3>
                    <p class="process-detail-desc">{item.description}</p>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </section>
      );

      if (d.section === "basics") return (
        <section class="section-basics animate-on-scroll relative py-section bg-gradient-to-b from-surface-alt to-surface-gradient-end">
          <div class="container">
            <div class="mb-12">
              <p class="text-15 font-semibold tracking-widest uppercase text-pop">What you get</p>
              <h2 class="font-heading text-section-title font-extrabold tracking-tight">{d.heading}</h2>
            </div>
            <ul class="list-none flex flex-col max-w-[1100px]">
              {d.items?.map((item, i) => (
                <li class="grid grid-cols-[320px_1fr] max-md:grid-cols-1 gap-x-20 max-md:gap-y-3 items-center py-8 border-b border-border-alt first:border-t first:border-border-alt">
                  <div class="flex items-center gap-3">
                    <span class="shrink-0 w-16 h-16 flex items-center justify-center text-pop" aria-hidden="true">
                      {i === 0 && (
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8">
                          <rect x="2" y="3" width="20" height="14" rx="2" />
                          <line x1="8" y1="21" x2="16" y2="21" />
                          <line x1="12" y1="17" x2="12" y2="21" />
                        </svg>
                      )}
                      {i === 1 && (
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8">
                          <polygon points="13,2 3,14 12,14 11,22 21,10 12,10" />
                        </svg>
                      )}
                      {i === 2 && (
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8">
                          <circle cx="11" cy="11" r="8" />
                          <line x1="21" y1="21" x2="16.65" y2="16.65" />
                        </svg>
                      )}
                      {i === 3 && (
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8">
                          <polyline points="16,18 22,12 16,6" />
                          <polyline points="8,6 2,12 8,18" />
                        </svg>
                      )}
                      {i === 4 && (
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8">
                          <path d="M20,21v-2a4,4,0,0,0-4-4H8a4,4,0,0,0-4,4v2" />
                          <circle cx="12" cy="7" r="4" />
                        </svg>
                      )}
                    </span>
                    <h3 class="text-[1.75rem] font-bold tracking-snug text-text whitespace-nowrap">{item.title}</h3>
                  </div>
                  <div>
                    <p class="leading-loose text-[1.125rem]" style="color: rgba(45, 49, 66, 0.80);">{item.description}</p>
                  </div>
                </li>
              ))}
            </ul>
          </div>
        </section>
      );

      if (d.section === "work") return (
        <section class="section-work animate-on-scroll relative py-section" id="work">
          <div class="container">
            <div class="mb-12">
              <p class="text-15 font-semibold tracking-widest uppercase text-accent-hover">Our work</p>
              <h2 class="font-heading text-section-title font-extrabold tracking-tight">{d.heading}</h2>
              {d.intro && <p class="text-text-muted mt-4 leading-loose">{d.intro}</p>}
            </div>
            <div class="grid grid-cols-2 max-md:grid-cols-1 gap-12">
              {caseStudies.map((study) => (
                <CaseStudyCard
                  title={study.title}
                  description={study.description}
                  link={study.link}
                  image={study.image}
                />
              ))}
            </div>
          </div>
        </section>
      );

      if (d.section === "cta") return (
        <CTA heading={d.heading} ctaText={d.cta_text} ctaLink={d.cta_link}>
          <Content />
        </CTA>
      );
    })}
  </main>

  <style>
    /* ── Force dark theme colors for process section ── */
    .section-process {
      background-color: var(--color-bg-dark-process);
      color: var(--color-text-light);
      --color-bg: var(--color-bg-dark-process);
      --color-surface: var(--color-bg-dark-process);
      --color-border: var(--color-border-dark);
      --color-border-subtle: var(--color-border-subtle-dark);
      --color-text: var(--color-text-light);
      --color-text-muted: var(--color-text-light-muted);
      --color-text-dim: var(--color-text-light-dim);
      --color-accent-hover: var(--color-primary-light);
      --color-pop: var(--color-secondary);
      overflow: hidden;
    }

    /* ── Process blob background animation ── */
    .process-blob-blur {
      position: absolute;
      top: -20%;
      right: 8%;
      width: 45%;
      aspect-ratio: 1;
      opacity: 0.8;
      filter: blur(82px);
      -webkit-filter: blur(82px);
      pointer-events: none;
      z-index: 0;
      transition: opacity 600ms var(--ease-out-expo);
    }

    /* Lower opacity for green and magenta blobs */
    .section-process[data-active="0"] .process-blob-blur,
    .section-process[data-active="3"] .process-blob-blur {
      opacity: 0.3;
    }

    .process-blob {
      width: 100%;
      height: 100%;
      transition: clip-path 600ms var(--ease-out-expo), background 600ms var(--ease-out-expo);
    }

    /* Blob shape and color for each step */
    .section-process[data-active="0"] .process-blob {
      clip-path: polygon(31% 43%, 3% 24%, 29% 69%, 97% 83%, 51% 27%, 31% 9%, 66% 99%, 81% 64%, 85% 31%, 85% 41%, 49% 76%, 12% 26%, 42% 43%, 79% 48%);
      background: var(--color-secondary);
    }

    .section-process[data-active="1"] .process-blob {
      clip-path: polygon(18% 52%, 8% 18%, 42% 71%, 89% 91%, 63% 35%, 25% 5%, 78% 88%, 91% 52%, 72% 19%, 95% 28%, 38% 84%, 5% 39%, 54% 51%, 68% 62%);
      background: var(--color-primary);
    }

    .section-process[data-active="2"] .process-blob {
      clip-path: polygon(35% 48%, 12% 28%, 45% 82%, 91% 71%, 55% 15%, 25% 35%, 78% 91%, 82% 52%, 88% 18%, 68% 65%, 32% 88%, 18% 22%, 71% 42%, 85% 75%);
      background: var(--color-tertiary);
    }

    .section-process[data-active="3"] .process-blob {
      clip-path: polygon(28% 58%, 11% 31%, 38% 85%, 92% 74%, 57% 19%, 33% 8%, 73% 92%, 88% 48%, 68% 26%, 81% 63%, 44% 95%, 18% 22%, 59% 44%, 75% 71%);
      background: var(--color-quaternary);
    }

    /* ── Hero decorative effects ── */

    .hero-aurora {
      position: absolute;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
      z-index: 0;
    }

    .hero-aurora-inner {
      --white: #ffffff;
      --black: #000000;
      --transparent: transparent;
      --aurora-1: #3b82f6;
      --aurora-2: #a5b4fc;
      --aurora-3: #93c5fd;
      --aurora-4: #ddd6fe;
      --aurora-5: #60a5fa;

      --base-gradient: repeating-linear-gradient(100deg, var(--black) 0%, var(--black) 7%, var(--transparent) 10%, var(--transparent) 12%, var(--black) 16%);
      --aurora: repeating-linear-gradient(100deg, var(--aurora-1) 10%, var(--aurora-2) 15%, var(--aurora-3) 20%, var(--aurora-4) 25%, var(--aurora-5) 30%);

      position: absolute;
      inset: -10px;
      background-image: var(--base-gradient), var(--aurora);
      background-size: 300%, 200%;
      background-position: 50% 50%, 50% 50%;
      filter: blur(10px);
      opacity: 0.5;
      will-change: transform;
      pointer-events: none;
      mask-image: radial-gradient(ellipse at 100% 0%, black 10%, var(--transparent) 70%);
      -webkit-mask-image: radial-gradient(ellipse at 100% 0%, black 10%, var(--transparent) 70%);
    }

    .hero-aurora-inner::after {
      content: "";
      position: absolute;
      inset: 0;
      background-image: var(--base-gradient), var(--aurora);
      background-size: 200%, 100%;
      background-attachment: fixed;
      mix-blend-mode: difference;
      animation: auroraFlow 60s linear infinite;
    }

    @keyframes auroraFlow {
      from {
        background-position: 50% 50%, 50% 50%;
      }
      to {
        background-position: 350% 50%, 350% 50%;
      }
    }

.hero-title {
      background: linear-gradient(to bottom right, var(--hero-title-gradient-start) 30%, var(--hero-title-gradient-end) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: fadeInUp 0.9s var(--ease-out-expo) both;
    }

    @supports not (background-clip: text) {
      .hero-title {
        background: none;
        -webkit-text-fill-color: unset;
        color: var(--color-text);
      }
    }

    .hero-tagline {
      animation: fadeInUp 0.9s var(--ease-out-expo) 0.1s both;
    }

    .hero-actions {
      animation: fadeInUp 0.9s var(--ease-out-expo) 0.25s both;
    }

    /* ── Primary CTA button ── */
    .btn-primary {
      display: inline-block;
      padding: 1rem 2.5rem;
      background: var(--color-accent);
      color: var(--color-btn-text);
      border-radius: 0.625rem;
      font-weight: 600;
      letter-spacing: -0.01em;
      transition: all 0.3s var(--ease-out-expo);
      box-shadow: 0 0 20px var(--color-accent-glow), 0 0 60px var(--color-accent-glow), inset 0 1px 0 rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.08);
      text-decoration: none;
    }

    .btn-primary:hover {
      background: var(--color-accent-hover);
      box-shadow: 0 0 30px var(--color-accent-glow-strong), 0 0 80px var(--color-accent-glow), 0 4px 16px var(--color-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.15);
      transform: translateY(-2px);
      text-decoration: none;
    }

    .btn-primary:active {
      transform: translateY(0);
      transition-duration: 0.1s;
    }

    /* ── Problem section decorative ── */
    .section-problem::after {
      content: '';
      position: absolute;
      top: 30%;
      right: -20%;
      width: 40%;
      height: 60%;
      background: radial-gradient(ellipse at center, rgba(126, 219, 87, 0.03) 0%, transparent 60%);
      pointer-events: none;
      z-index: 0;
    }

    .highlight {
      color: var(--color-btn-text);
      background: var(--color-accent);
      padding: 0.05em 0.15em;
      border-radius: 0.25em;
      font-style: normal;
      font-weight: 600;
      box-decoration-break: clone;
      -webkit-box-decoration-break: clone;
    }

    /* ── Process section (interactive left-right layout) ── */
    .process-panel {
      display: grid;
      grid-template-columns: 1fr 1.4fr;
      gap: 4rem;
      align-items: start;
      min-height: 320px;
    }

    .process-nav {
      display: flex;
      flex-direction: column;
    }

    .process-nav-item {
      all: unset;
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.25rem 0;
      cursor: pointer;
      position: relative;
      border-bottom: 1px solid var(--color-border);
      transition: padding-left 400ms var(--ease-out-expo);
    }

    .process-nav-item:first-child {
      border-top: 1px solid var(--color-border);
    }

    .process-nav-number {
      font-family: var(--font-mono);
      font-size: 0.8125rem;
      color: var(--color-text-dim);
      letter-spacing: 0.05em;
      min-width: 2rem;
      transition: color 400ms var(--ease-out-expo);
    }

    .process-nav-line {
      width: 2rem;
      height: 2px;
      background: var(--color-border);
      border-radius: 1px;
      transition: width 400ms var(--ease-out-expo), background 400ms var(--ease-out-expo);
    }

    .process-nav-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--color-text-muted);
      transition: color 400ms var(--ease-out-expo);
      letter-spacing: -0.01em;
    }

    .process-nav-item:hover .process-nav-title { color: var(--color-text); }
    .process-nav-item:hover .process-nav-line { background: var(--color-text-dim); }

    /* Active nav item states */
    .process-panel[data-active="0"] .process-nav-item[data-index="0"],
    .process-panel[data-active="1"] .process-nav-item[data-index="1"],
    .process-panel[data-active="2"] .process-nav-item[data-index="2"],
    .process-panel[data-active="3"] .process-nav-item[data-index="3"] {
      padding-left: 0.5rem;
    }

    /* Step 0 - Lime */
    .process-panel[data-active="0"] .process-nav-item[data-index="0"] .process-nav-number {
      color: var(--color-secondary);
    }
    .process-panel[data-active="0"] .process-nav-item[data-index="0"] .process-nav-line {
      width: 3rem;
      background: var(--color-secondary);
    }
    .process-panel[data-active="0"] .process-detail-number {
      color: var(--color-secondary);
    }

    /* Step 1 - Teal */
    .process-panel[data-active="1"] .process-nav-item[data-index="1"] .process-nav-number {
      color: var(--color-primary);
    }
    .process-panel[data-active="1"] .process-nav-item[data-index="1"] .process-nav-line {
      width: 3rem;
      background: var(--color-primary);
    }
    .process-panel[data-active="1"] .process-detail-number {
      color: var(--color-primary);
    }

    /* Step 2 - Orange */
    .process-panel[data-active="2"] .process-nav-item[data-index="2"] .process-nav-number {
      color: var(--color-tertiary);
    }
    .process-panel[data-active="2"] .process-nav-item[data-index="2"] .process-nav-line {
      width: 3rem;
      background: var(--color-tertiary);
    }
    .process-panel[data-active="2"] .process-detail-number {
      color: var(--color-tertiary);
    }

    /* Step 3 - Magenta */
    .process-panel[data-active="3"] .process-nav-item[data-index="3"] .process-nav-number {
      color: var(--color-quaternary);
    }
    .process-panel[data-active="3"] .process-nav-item[data-index="3"] .process-nav-line {
      width: 3rem;
      background: var(--color-quaternary);
    }
    .process-panel[data-active="3"] .process-detail-number {
      color: var(--color-quaternary);
    }

    .process-panel[data-active="0"] .process-nav-item[data-index="0"] .process-nav-title,
    .process-panel[data-active="1"] .process-nav-item[data-index="1"] .process-nav-title,
    .process-panel[data-active="2"] .process-nav-item[data-index="2"] .process-nav-title,
    .process-panel[data-active="3"] .process-nav-item[data-index="3"] .process-nav-title {
      color: var(--color-text);
      font-weight: 700;
    }

    /* Detail panels */
    .process-details {
      position: relative;
      min-height: 380px;
    }

    .process-detail {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      opacity: 0;
      visibility: hidden;
      transform: translateY(8px);
      transition: opacity 400ms var(--ease-out-expo), visibility 400ms, transform 400ms var(--ease-out-expo);
    }

    .process-panel[data-active="0"] .process-detail[data-index="0"],
    .process-panel[data-active="1"] .process-detail[data-index="1"],
    .process-panel[data-active="2"] .process-detail[data-index="2"],
    .process-panel[data-active="3"] .process-detail[data-index="3"] {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .process-detail-number {
      display: block;
      font-family: var(--font-mono);
      font-size: 3rem;
      font-weight: 700;
      opacity: 0.6;
      line-height: 1;
      margin-bottom: 1.5rem;
      letter-spacing: -0.02em;
      transition: color 400ms var(--ease-out-expo);
    }

    .process-detail-title {
      font-size: 2.25rem;
      font-weight: 700;
      margin-bottom: 1rem;
      letter-spacing: -0.01em;
      color: var(--color-text);
    }

    .process-detail-desc {
      font-size: 1.25rem;
      color: var(--color-text-muted);
      line-height: 1.8;
      max-width: 520px;
    }


    @media (prefers-reduced-motion: reduce) {
      .hero-aurora-inner::after {
        animation: none;
      }
    }

    /* ── Mobile overrides ── */
    @media (max-width: 768px) {
      .hero {
        min-height: 100svh;
        align-items: center;
      }

      .hero-title {
        letter-spacing: -0.02em;
      }

      .btn-primary {
        padding: 0.875rem 2rem;
        font-size: 1.25rem;
        width: 100%;
        text-align: center;
      }

      /* Increase section title size and weight on mobile */
      :root {
        --text-section-title: 3rem;
        --text-problem-title: 3rem;
      }

      .text-section-title {
        font-weight: 900;
        line-height: 1;
      }

      .text-problem-title {
        font-weight: 900;
        line-height: 1;
      }

      .section-problem {
        padding: 4rem 0;
        overflow: hidden;
      }

      .section-problem-kicker {
        font-size: 1.5rem;
      }

      /* Add horizontal padding to basics section list */
      .section-basics ul {
        padding-left: 1.5rem;
        padding-right: 1.5rem;
      }

      /* Reduce spacing in basics list items */
      .section-basics li {
        padding-top: 1.5rem;
        padding-bottom: 1.5rem;
        gap: 0.5rem;
      }

      /* Tighter spacing between title and description */
      .section-basics h3 {
        margin-bottom: 0.25rem;
      }

      /* Align description with title (offset by icon width + gap) */
      .section-basics li > div:last-child {
        padding-left: calc(4rem + 0.75rem);
      }

      /* Reposition blob for mobile - align with active accordion item */
      .process-blob-blur {
        width: 80%;
        right: -20%;
        top: 10%;
        opacity: 0.4;
        filter: blur(60px);
        transition: top 600ms var(--ease-out-expo), opacity 600ms var(--ease-out-expo);
      }

      /* Move blob to align with each active tab */
      .section-process[data-active="0"] .process-blob-blur {
        top: 5%;
      }

      .section-process[data-active="1"] .process-blob-blur {
        top: 18%;
      }

      .section-process[data-active="2"] .process-blob-blur {
        top: 31%;
      }

      .section-process[data-active="3"] .process-blob-blur {
        top: 44%;
      }

      /* Accordion layout for mobile */
      .process-panel {
        display: flex;
        flex-direction: column;
        gap: 0;
        min-height: auto;
      }

      .process-nav {
        display: contents;
      }

      .process-nav-item {
        order: calc(var(--item-index) * 2);
        border-top: 1px solid var(--color-border);
        border-bottom: none;
        padding: 1.5rem 0;
        width: 100%;
      }

      .process-nav-item[data-index="0"] { --item-index: 0; }
      .process-nav-item[data-index="1"] { --item-index: 1; }
      .process-nav-item[data-index="2"] { --item-index: 2; }
      .process-nav-item[data-index="3"] { --item-index: 3; }

      .process-nav-number {
        transition: color 300ms var(--ease-out-expo), font-size 300ms var(--ease-out-expo);
      }

      .process-nav-title {
        transition: font-size 300ms var(--ease-out-expo), font-weight 300ms var(--ease-out-expo);
      }

      /* Style active nav item - slightly larger and colored */
      .process-panel[data-active="0"] .process-nav-item[data-index="0"] .process-nav-number,
      .process-panel[data-active="1"] .process-nav-item[data-index="1"] .process-nav-number,
      .process-panel[data-active="2"] .process-nav-item[data-index="2"] .process-nav-number,
      .process-panel[data-active="3"] .process-nav-item[data-index="3"] .process-nav-number {
        font-size: 1.5rem;
      }

      .process-panel[data-active="0"] .process-nav-item[data-index="0"] .process-nav-title,
      .process-panel[data-active="1"] .process-nav-item[data-index="1"] .process-nav-title,
      .process-panel[data-active="2"] .process-nav-item[data-index="2"] .process-nav-title,
      .process-panel[data-active="3"] .process-nav-item[data-index="3"] .process-nav-title {
        font-size: 1.75rem;
        font-weight: 700;
      }

      /* Color the number for each active step */
      .process-panel[data-active="0"] .process-nav-item[data-index="0"] .process-nav-number {
        color: var(--color-secondary);
      }

      .process-panel[data-active="1"] .process-nav-item[data-index="1"] .process-nav-number {
        color: var(--color-primary);
      }

      .process-panel[data-active="2"] .process-nav-item[data-index="2"] .process-nav-number {
        color: var(--color-tertiary);
      }

      .process-panel[data-active="3"] .process-nav-item[data-index="3"] .process-nav-number {
        color: var(--color-quaternary);
      }

      .process-nav-line {
        display: none;
      }

      .process-details {
        display: contents;
      }

      .process-detail {
        position: relative;
        opacity: 1;
        visibility: visible;
        transform: none;
        order: calc(var(--detail-index) * 2 + 1);
        max-height: 0;
        overflow: hidden;
        transition: max-height 400ms var(--ease-out-expo), padding 400ms var(--ease-out-expo);
        padding: 0;
        border: none;
      }

      .process-detail[data-index="0"] { --detail-index: 0; }
      .process-detail[data-index="1"] { --detail-index: 1; }
      .process-detail[data-index="2"] { --detail-index: 2; }
      .process-detail[data-index="3"] { --detail-index: 3; }

      .process-panel[data-active="0"] .process-detail[data-index="0"],
      .process-panel[data-active="1"] .process-detail[data-index="1"],
      .process-panel[data-active="2"] .process-detail[data-index="2"],
      .process-panel[data-active="3"] .process-detail[data-index="3"] {
        max-height: 500px;
        padding: 0 0 2rem;
      }

      .process-detail-number {
        font-size: 2rem;
        margin-bottom: 1rem;
      }

      .process-detail-title {
        transition: opacity 300ms var(--ease-out-expo);
      }

      /* Hide detail title and number on mobile - nav item shows them */
      .process-detail-number,
      .process-detail-title {
        display: none;
      }

      /* Bottom border for last nav item to close accordion */
      .process-nav-item[data-index="3"] {
        border-bottom: 1px solid var(--color-border);
      }

      /* Remove bottom border when last item is active (expanded) */
      .process-panel[data-active="3"] .process-nav-item[data-index="3"] {
        border-bottom: none;
      }

      /* Add bottom border to last detail when it's expanded */
      .process-panel[data-active="3"] .process-detail[data-index="3"] {
        border-bottom: 1px solid var(--color-border);
        padding-bottom: 2rem;
      }

      .section-cta {
        padding: 5rem 0;
      }

      .btn-cta {
        padding: 0.875rem 2rem;
        font-size: 1rem;
        width: 100%;
        text-align: center;
      }
    }
  </style>

  <script>
    const panel = document.querySelector('.process-panel');
    const section = document.querySelector('.section-process');
    if (panel && section) {
      const isMobile = () => window.innerWidth <= 768;

      panel.querySelectorAll('.process-nav-item').forEach(item => {
        const index = (item as HTMLElement).dataset.index!;

        // Click handler for both mobile (accordion) and desktop
        item.addEventListener('click', () => {
          // Always keep one panel open - no collapsing
          panel.setAttribute('data-active', index);
          section.setAttribute('data-active', index);
        });

        // Desktop hover behavior
        if (!isMobile()) {
          item.addEventListener('mouseenter', () => {
            panel.setAttribute('data-active', index);
            section.setAttribute('data-active', index);
          });
        }

        item.addEventListener('focus', () => {
          panel.setAttribute('data-active', index);
          section.setAttribute('data-active', index);
        });
      });

      // Set initial state
      section.setAttribute('data-active', '0');
    }

  </script>

</Base>
