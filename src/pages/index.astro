---
import { getCollection, render } from "astro:content";
import Base from "../layouts/Base.astro";
import CaseStudyCard from "../components/CaseStudyCard.astro";

const sections = (await getCollection("homepage")).sort(
  (a, b) => a.data.order - b.data.order
);

const rendered = await Promise.all(
  sections.map(async (s) => ({
    ...s,
    rendered: await render(s),
  }))
);

const caseStudies = [
  {
    title: "E-Commerce Platform",
    description:
      "A high-performance online store with real-time inventory management and seamless checkout experience.",
    techStack: ["Next.js", "Stripe", "PostgreSQL"],
  },
  {
    title: "SaaS Dashboard",
    description:
      "Analytics dashboard with interactive data visualizations and role-based access control.",
    techStack: ["React", "D3.js", "Node.js"],
  },
  {
    title: "Mobile Banking App",
    description:
      "Secure mobile application for digital banking with biometric authentication and instant transfers.",
    techStack: ["React Native", "TypeScript", "AWS"],
  },
];

const year = new Date().getFullYear();
---

<Base title="Plain Sight | Web Development Agency">
  <main>
    {rendered.map((section) => {
      const { Content } = section.rendered;
      const d = section.data;

      if (d.section === "hero") return (
        <section class="hero">
          <div class="container">
            <div class="hero-content">
              <h1 class="hero-title">{d.heading}</h1>
              <p class="hero-tagline">{d.subheading}</p>
              {d.cta_text && <a href={d.cta_link} class="btn">{d.cta_text}</a>}
            </div>
          </div>
        </section>
      );

      if (d.section === "problem") return (
        <section class="section">
          <div class="container">
            <h2 class="section-title">{d.heading}</h2>
            <div class="section-prose">
              <Content />
            </div>
          </div>
        </section>
      );

      if (d.section === "differentiators") return (
        <section class="section">
          <div class="container">
            <h2 class="section-title">{d.heading}</h2>
            <div class="items-grid">
              {d.items?.map((item) => (
                <div class="item-card">
                  <h3>{item.title}</h3>
                  <p>{item.description}</p>
                </div>
              ))}
            </div>
          </div>
        </section>
      );

      if (d.section === "process") return (
        <section class="section">
          <div class="container">
            <h2 class="section-title">{d.heading}</h2>
            <div class="process-grid">
              {d.items?.map((item) => (
                <div class="process-card">
                  <h3>{item.title}</h3>
                  <p>{item.description}</p>
                </div>
              ))}
            </div>
          </div>
        </section>
      );

      if (d.section === "work") return (
        <section class="section" id="work">
          <div class="container">
            <h2 class="section-title">{d.heading}</h2>
            {d.intro && <p class="section-intro">{d.intro}</p>}
            <div class="case-studies-grid">
              {caseStudies.map((study) => (
                <CaseStudyCard
                  title={study.title}
                  description={study.description}
                  techStack={study.techStack}
                />
              ))}
            </div>
          </div>
        </section>
      );

      if (d.section === "cta") return (
        <section class="section" id="contact">
          <div class="container">
            <h2 class="section-title">{d.heading}</h2>
            <div class="section-prose">
              <Content />
            </div>
            {d.cta_text && <a href={d.cta_link} class="btn">{d.cta_text}</a>}
          </div>
        </section>
      );
    })}
  </main>

  <footer class="footer">
    <div class="container">
      <p>&copy; {year} Plain Sight. All rights reserved.</p>
    </div>
  </footer>
</Base>
