---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import Base from "../layouts/Base.astro";
import demiHero from "../assets/case-studies/demi-hero.png";
import upmealsHero from "../assets/case-studies/upmeals-hero.png";

const projects = (await getCollection("work")).sort(
  (a, b) => a.data.order - b.data.order
);

const heroImages: Record<number, ImageMetadata> = {
  1: demiHero,
  2: upmealsHero,
};
---

<Base title="Work | Plain Sight" description="Selected projects showing our strategic approach to web development.">
  <main class="container pt-32 max-md:pt-24">
    <section class="bg-surface border border-border rounded-2xl py-14 px-12 max-md:py-10 max-md:px-6 mb-10">
      <h1 class="text-page-hero font-extrabold leading-snug mb-4">See for yourself</h1>
      <p class="text-[1.125rem] text-text-muted leading-loose max-w-[600px]">Sites that look great and actually drive results for the businesses behind them</p>
    </section>

    {projects.map((project, i) => {
      const d = project.data;
      const heroImage = heroImages[d.order];
      const isAlt = i % 2 === 0;
      return (
        <section class={`${isAlt ? 'bg-surface-raised' : 'bg-surface'} border border-border rounded-2xl p-10 max-md:py-8 max-md:px-6 mb-8 overflow-hidden`} id={d.title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '')}>
          <h2 class="text-case-study-title font-bold leading-[1.2] mb-6">{d.title}</h2>

          <div class="mb-8 rounded-xl overflow-hidden border border-border">
            {heroImage ? (
              <Image src={heroImage} alt={d.title} width={1100} class="w-full h-auto block" />
            ) : (
              <div class={`aspect-hero ${isAlt ? 'bg-surface' : 'bg-surface-raised'} border-2 border-dashed border-border rounded-xl flex items-center justify-center`}>
                <span class="text-text-dim text-[0.9rem]">Hero image</span>
              </div>
            )}
          </div>

          <div class="max-w-[800px]">
            <div>
              <h3 class="text-xl font-bold mb-2 text-text">Client Challenge</h3>
              <p class="text-17 text-text-muted leading-loose mb-8">{d.challenge}</p>
            </div>

            <div>
              <h3 class="text-xl font-bold mb-2 text-text">Our Strategic Approach</h3>
              <p class="text-17 text-text-muted leading-loose mb-8">{d.approach}</p>
            </div>

            <div class="grid grid-cols-2 max-md:grid-cols-1 gap-4 mb-8">
              <div class={`aspect-hero ${isAlt ? 'bg-surface' : 'bg-surface-raised'} border-2 border-dashed border-border rounded-xl flex items-center justify-center`}>
                <span class="text-text-dim text-[0.9rem]">Project image</span>
              </div>
              <div class={`aspect-hero ${isAlt ? 'bg-surface' : 'bg-surface-raised'} border-2 border-dashed border-border rounded-xl flex items-center justify-center`}>
                <span class="text-text-dim text-[0.9rem]">Project image</span>
              </div>
            </div>

            <div>
              <h3 class="text-xl font-bold mb-2 text-text">Solution</h3>
              <p class="text-17 text-text-muted leading-loose mb-8">{d.solution}</p>
            </div>

            <div>
              <h3 class="text-xl font-bold mb-2 text-text">Results</h3>
              <p class="text-17 text-text-muted leading-loose mb-8">{d.results}</p>
            </div>

            <div class="flex items-center gap-3 pt-2 border-t border-border mt-2">
              <span class="font-semibold text-[0.9rem]">Tech Stack</span>
              <span class="text-text-muted text-[0.9rem]">{d.tech}</span>
            </div>
          </div>
        </section>
      );
    })}

    <section class="section-cta mt-8">
      <div class="cta-glow" aria-hidden="true"></div>
      <div class="cta-content">
        <h2 class="cta-title">Your project could be next</h2>
        <p class="cta-prose">We're building this out one great project at a time. Curious if we're the right fit for what you're building?</p>
        <a href="/contact" class="btn btn-cta">Reach out</a>
      </div>
    </section>
  </main>
</Base>
